---
title: "Hank Green's Mystery of Bronze"
format: html
editor: visual
---

## Introduction

Last week an influencer whose content I quite enjoy - Hank Green - released a video sharing an interesting pattern he noticed in Olympic summer game medal distributions. He had noticed that, after you some up all the relevant countries, Europe consistently goes home with a lot more Bronze than Gold and Silver.

Now, a big factor for this pattern quite simple and he has already released another video that "debunks" his original observation using it. The Olympics just hand out more Bronze that Gold. Some of the spots that use a tournament structure let the two athletes that lost their semi-finals duke it out for the last medal, but others just make their podiums big enough to fit two 3rd places.

Once this quirk is adjusted for the European pattern will become a lot less distinct, but it doesn't disappear. Since I am currently jobless I decided to write this report looking closer into what's left.

As data source I will use something I have actually already worked with. Some weeks ago the weekly #TidyTuesday Data Visualization Events featured a pre-cleaned dataset featuring all athetes participanting in the Olympics up to 2016 and their results. 2018 to 2024 are thus missing and I will further remove all of the pre-WW2 games as well as restrict myself to Summer games to get a more homogeneous dataset.

add caption, Bronze and silver interchangeable after adjustment. Gold still suspsicious

```{r}
library(dplyr)
library(ggplot2)
library(tidytuesdayR)
library(ggalluvial)
library(ggbeeswarm)

data <- tidytuesdayR::tt_load('2024-08-06')
data<-data$olympics

#grab below from wikipedia, RUS and soviet removed because they arent that europe-ish
codes_EU<-"ALB,AND,ARM,AUT,AZE,BEL,BIH,BLR,BUL,CRO,CYP,CZE,DEN,ESP,EST,FIN,FRA,GBR,GEO,GER,GRE,HUN,IRL,ISL,ISR,ITA,KOS,LAT,LIE,LTU,LUX,MDA,MKD,MLT,MNE,MON,NED,NOR,POL,POR,ROU,SLO,SMR,SRB,SUI,SVK,SWE,TUR,UKR,TCH,GDR,SCG,YUG"%>%
  strsplit(",")%>%
  unlist()

europe_sums<-data%>%
  filter(grepl("Summer",games))%>%
  filter(year>=1948)%>%
  filter(!is.na(medal))%>%
  distinct(noc,year,event,medal)%>%
  group_by(year)%>%
  mutate(
    n_bronze=sum(medal=="Bronze"),
    n_silver=sum(medal=="Silver"),
    n_gold=sum(medal=="Gold"),
  )%>%
  filter(noc%in%codes_EU)%>%
  summarize(
    gold=sum(medal=="Gold")/first(n_gold),
    silver=sum(medal=="Silver")/first(n_silver),
    bronze=sum(medal=="Bronze")/first(n_bronze)
  )

europe_sums%>%
  tidyr::pivot_longer(cols=gold:bronze)%>%
  ggplot(
    aes(x=year,y=value,col=name)
    )+
  geom_line()+
  scale_y_continuous("Europe's Bounty among all Medals",labels = scales::percent,minor_breaks = NULL)+
  coord_cartesian(ylim = c(0.29,0.76),expand = F,xlim = c(1946,2018))+
  scale_x_continuous(NULL,breaks = seq(1948,2016,by=4),minor_breaks = NULL)+
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
    legend.position = "none"
    )+
  scale_color_manual(NULL,values=c(gold="#d6af36",silver="#a7a7a7",bronze="#a77044"))

```

## How about other groups of small and medium countries?

Haiti, Austria, Nigeria, Kazakhstan, Thailand, Oman, Portugal

```{r}
hank_sums<-data%>%
  filter(grepl("Summer",games))%>%
  filter(year>=1948)%>%
  filter(!is.na(medal))%>%
  distinct(noc,year,event,medal)%>%
  group_by(year)%>%
  mutate(
    n_bronze=sum(medal=="Bronze"),
    n_silver=sum(medal=="Silver"),
    n_gold=sum(medal=="Gold"),
  )%>%
  filter(substr(noc,1,1)%in%c("H","A","N","K","T","O","P"))%>%
  summarize(
    gold=sum(medal=="Gold")/first(n_gold),
    silver=sum(medal=="Silver")/first(n_silver),
    bronze=sum(medal=="Bronze")/first(n_bronze)
  )

hank_sums%>%
  tidyr::pivot_longer(cols=gold:bronze)%>%
  ggplot(
    aes(x=year,y=value,col=name)
    )+
  geom_line()+
  scale_y_continuous("Bounty of HANKTOP among all Medals",labels = scales::percent,minor_breaks = NULL)+
  coord_cartesian(ylim = c(0.04,0.36),expand = F,xlim = c(1946,2018))+
  scale_x_continuous(NULL,breaks = seq(1948,2016,by=4),minor_breaks = NULL)+
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
    legend.position = "none"
    )+
  scale_color_manual(NULL,values=c(gold="#d6af36",silver="#a7a7a7",bronze="#a77044"))

```

## Who actually gets more Gold?

```{r}
all_sums<-data%>%
  filter(year>=1948)%>%
  filter(grepl("Summer",games))%>%
  filter(!is.na(medal))%>%
  distinct(noc,year,event,medal)%>%
  mutate(
    time_period=case_when(
      year%in%c(1972,1976,1980,1984)~"Odd years",
      TRUE~"Rest"
    )
  )%>%
  group_by(year,noc)%>%
  summarize(
    gold=sum(medal=="Gold"),
    silver=sum(medal=="Silver"),
    bronze=sum(medal=="Bronze"),
    time_period=first(time_period)
  )%>%
  ungroup()%>%
  group_by(year)%>%
  mutate(
    n_g=sum(gold),
    n_s=sum(silver),
    n_b=sum(bronze)
    )%>%
  ungroup()

all_sums%>%
  mutate(
    sum_m=gold+silver+bronze,
    Gold=gold/n_g,
    Silver=silver/n_s,
    Bronze=bronze/n_b
    )%>%
  group_by(year)%>%
  slice_max(sum_m,n=2,with_ties = F)%>%
  summarize(
    Gold=sum(Gold),
    Silver=sum(Silver),
    Bronze=sum(Bronze)
    )%>%
  ungroup()%>%
  tidyr::pivot_longer(Gold:Bronze)%>%
  ggplot(aes(y=value,x=year,col=name))+
  geom_line()+
  coord_cartesian(ylim=c(0,0.65))
```

does europe lose against repeat winners?

## 1st Idea: Repeat Winners

do sankey

Most countries don't produce bileses

cultural attitude, money

Things get dirtier

```{r}
group_events<-data%>%
  filter(year>=1948)%>%
  filter(grepl("Summer",games))%>%
  filter(medal=="Gold")%>%
  group_by(event,year)%>%
  filter(n()!=1)%>%
  group_by(event)%>%
  summarize(
    n_years=length(unique(year))
  )%>%
  ungroup()

gold_first_year<-data%>%
  filter(year>=1948)%>%
  filter(grepl("Summer",games))%>%
  filter(year!=2016)%>%
  filter(!(year==1988&noc=="URS"))%>%#last one for them
  filter(!(year==1980&noc=="URS"))%>%#boycott 1984
  filter(!(year==1976&noc=="USA"))%>%#boycott 1980
  filter(!event%in%group_events$event)%>%
  group_by(noc,name,event)%>%
  filter(medal=="Gold")%>%
  slice_min(year,n=1,with_ties = FALSE)%>%
  ungroup()%>%
  select(noc,name,event,year_medal=year)

medal_repeats<-data%>%
  select(year,name,noc,event,medal)%>%
  right_join(gold_first_year)%>%
  group_by(name,event,noc)%>%
  summarize(
    status=case_when(
      all(year<=year_medal)~"No later appearance",
      any(medal=="Gold"&year>year_medal)~"More gold",
      any(medal%in%c("Silver","Bronze")&year>year_medal)~"Silver or bronze",
      TRUE~"Appearance without medal"
    )
  )%>%
  ungroup()

medal_repeats%>%#create better Viz, maybe per game just medals from previous winners
  mutate(
    group=case_when(
      noc%in%codes_EU~"Europe",
      noc%in%c("USA")~"USA",
      noc%in%c("CHN")~"China",
      noc%in%c("URS")~"Soviet Union",
      TRUE~"rest"
    )
  )%>%
  filter(group!="rest")%>%
  #tidyr::pivot_longer(cols=gold:part,names_to = "cat")%>%
  mutate(
    legacy=status%>%factor(levels = c("No later appearance","Appearance without medal","Silver or bronze", "More gold"))
  )%>%
  group_by(group)%>%
  mutate(
    group_size=n(),
  )%>%
  group_by(group,legacy)%>%
  summarize(prop=first(n()/group_size))%>%
  ungroup()%>%
  ggplot(aes(x=legacy,y=prop))+
  geom_bar(stat="identity")+
  facet_grid(cols=vars(group))

also add gold as facet, put group as col and adj rather than facet
```

Number of repeat nonwinners actually crazy low for top

former golds produce medals, not gold

```{r}
year_for_join<-data%>%
  filter(year>=1948)%>%
  filter(grepl("Summer",games))%>%
  filter(!event%in%group_events$event)%>%
  mutate(
    group=case_when(
      noc%in%codes_EU~"europe",
      noc%in%c("USA","CHN", "URS")~"top",
      TRUE~"rest"
    )
  )%>%
  filter(group!="rest")%>%
  mutate(
    cat=case_when(
      medal=="Gold"~"Gold",
      !is.na(medal)~"Silver or bronze",
      TRUE~"Participation"
    )
  )%>%
  ungroup()%>%
  mutate(year_join=year-4)%>%
  select(noc,name,event,year,year_join,cat,group)

for_sankey=year_for_join%>%
  filter(year!=1948)%>%
  filter(!(year==1988&noc=="URS"))%>%#boycott 1984
  filter(!(year==1984&noc=="USA"))%>%#boycott 1980
  full_join(
    year_for_join%>%
      filter(year!=2016)%>%
      filter(!(year==1988&noc=="URS"))%>%#last one for them
      filter(!(year==1980&noc=="URS"))%>%#boycott 1984
      filter(!(year==1976&noc=="USA"))%>%#boycott 1980
      select(-year_join)%>%
      rename(cat_before=cat),
    by=c("noc","group","name","event","year_join"="year")
  )%>%
  mutate(
    across(c(cat,cat_before),~case_when(
      is.na(.x)~"Not there",
      TRUE~.x
    )%>%factor(levels = c("Gold","Not there","Silver or bronze","Participation")))
  )%>%
  mutate(
    first=factor("This",levels=c("This","That")),
    second=factor("That",levels=c("This","That"))
  )

whre do medals come from per country for both gold and all
```

## 2nd Idea: The Peak is Political

data from figure above, visualize who got had the best gold ratios over the years

no mechanism to train athletes toward specifically being third-best

General wealth gets you medal, but Gold needs something more special

```{r}
all_sums%>%
  filter((gold+silver+bronze)>=10)%>%
  mutate(
    bmg=bronze-gold,
    group=case_when(
        noc=="USA"~"USA",
        noc%in%c("RUS","URS","EUN")~"Soviet/Russia",
        noc=="CHN"~"China",
        TRUE~"Rest"
    )
    )%>%
  ggplot(aes(x=bmg,y=year,col=group))+
  geom_jitter(width = 0.3,height = 0.9)

use vertical lines to visuals
change to perc of medals
```
